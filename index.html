<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/QRCode20250612/manifest.json">

  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="/QRCode20250612/GBP192.png">

  <!-- PWA æ”¯æ´å…ƒæ¨™ç±¤-->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="æ™ºèƒ½æ¢ç¢¼">


  <title>æ™ºèƒ½æ¢ç¢¼</title>
  
  <!-- ç¶²ç«™ favicon -->
  <link rel="icon" href="/QRCode20250612/GBP192.png" type="image/x-icon">
  
  <!-- å¼•ç”¨å¤–éƒ¨ CSS æ–‡ä»¶ -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <button id="backToTop" style="display:none;">â†‘ Top â†‘</button>
  <div class="header">
    <h1>æ™ºèƒ½æ¢ç¢¼</h1>
    <input type="text" id="search" placeholder="ğŸ”æœå°‹" oninput="filterItems()">
  </div>

  <div class="section">  
      <h2>æ¢ç¢¼åˆ†é¡</h2>
  </div>
  
  <div class="container" id="main-container"></div>

<div class="section">  
    <h2>æ¢ç¢¼ç”Ÿæˆ</h2>
</div>
<div class="container">
    <div id="qrcode-container">
        <canvas id="qrCanvas"></canvas>
        <input type="text" id="barcodeInput" oninput="updateQRCode()" placeholder="è¼¸å…¥æ¢ç¢¼">
    </div>
</div>
  
    <div class="section">
      <h2>éšœç¤™æ¯”ç‡</h2>
    </div>
   <div class="container"> 
    <table>
        <tr>
            <th></th>
            <th style="font-weight:bold">å³è€³</th>
            <th style="font-weight:bold">å·¦è€³</th>
        </tr>
        <tr>
            <th>500Hz</th>
            <td><input type="text" id="rightEar_500Hz"></td>
            <td><input type="text" id="leftEar_500Hz"></td>
        </tr>
        <tr>
            <th>1K Hz</th>
            <td><input type="text" id="rightEar_1000Hz"></td>
            <td><input type="text" id="leftEar_1000Hz"></td>
        </tr>
        <tr>
            <th>2K Hz</th>
            <td><input type="text" id="rightEar_2000Hz"></td>
            <td><input type="text" id="leftEar_2000Hz"></td>
        </tr>
        <tr>
            <th>4K Hz</th>
            <td><input type="text" id="rightEar_4000Hz"></td>
            <td><input type="text" id="leftEar_4000Hz"></td>
        </tr>
        <tr>
            <td></td>
            <td><button onclick="calculatePTA()">è¨ˆç®—</button></td>
            <td><button onclick="clearInput()">æ¸…ç©º</button></td>
        </tr>
        <tr>
            <th style="font-weight:bold">å„ªè€³</th>
            <td colspan="2" id="betterEar" style="font-weight:bold"></td>
        </tr>
        <tr>
            <th>PTA(dB)</th>
            <td id="rightEar_PTA"></td>
            <td id="leftEar_PTA"></td>
        </tr>
        <tr>
            <th style="font-weight:bold">å–®è€³(%)</th>
            <td id="rightEar_HL"></td>
            <td id="leftEar_HL"></td>
        </tr>
        <tr>
            <th style="font-weight:bold">é›™è€³(%)</th>
            <td colspan="2" id="bilateral_HL"></td>
        </tr>
      </table>
  </div>
  <div class="container">
    <h3>åƒè€ƒå…¬å¼èˆ‡æ³¨æ„äº‹é …</h3>
              <ul>
                <li>PTA(dB)=(500Hz+1000Hz+2000Hz+4000Hz)/4</li>
                <li>å–®è€³éšœç¤™æ¯”ç‡(%)=(PTA-25)*1.5%</li>
                <li>é›™è€³éšœç¤™æ¯”ç‡(%)=(å„ªè€³éšœç¤™æ¯”ç‡%*5 + åŠ£è€³éšœç¤™æ¯”ç‡%*1)/6</li>
                <li>è¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯å¦å–å¾—èº«éšœè³‡æ ¼ä»éœ€ç›¸é—œæ©Ÿæ§‹æ­£å¼å ±å‘Šèªå®š</li>
              </ul>
  </div>
    <!-- ç¬¬å››å€å¡Šï¼šé…ä»¶ç›¤é» -->
    <div class="section">
      <h2>é…ä»¶ç›¤é»</h2>
      <input type="file" id="fileInput" accept=".xlsx, .xls">
      <button onclick="uploadFile()">ç”Ÿæˆæ¢ç¢¼</button>
      <div id="inventoryContainer"></div>
    </div>

  <!-- JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const container = document.getElementById('inventoryContainer');
      container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
      const file = fileInput.files[0];
      if (!file) return alert("è«‹é¸æ“‡æª”æ¡ˆï¼");

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });

        workbook.SheetNames.forEach(sheetName => {
          const rows = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
          rows.slice(1).forEach(row => {
            const qrData = row[2] || ''; // æ¢ç¢¼ç·¨è™Ÿ
            const details = {
              partNumber: row[0] || 'æœªçŸ¥æ–™è™Ÿ',
              name: row[1] || 'æœªçŸ¥åç¨±',
              barcode: row[2] || 'æœªçŸ¥æ¢ç¢¼',
              quantity: row[3] || 'æœªçŸ¥æ•¸é‡',
            };

            // å‰µå»ºè¡Œ
            const rowDiv = document.createElement('div');
            rowDiv.className = 'item-row';

            // å‰µå»ºQR Codeåœ–ç‰‡
            const img = document.createElement('img');
            QRCode.toDataURL(qrData, function(err, url) {
              img.src = url || '';
            });

            // å‰µå»ºæ–‡å­—è©³æƒ…
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'item-details';
            detailsDiv.innerHTML = `
              <p><strong>æ–™è™Ÿï¼š</strong>${details.partNumber}</p>
              <p><strong>åç¨±ï¼š</strong>${details.name}</p>
              <p><strong>ç”¢å“æ¢ç¢¼ï¼š</strong>${details.barcode}</p>
              <p><strong>æ•¸é‡ï¼š</strong>${details.quantity}</p>
            `;

            // å°‡åœ–ç‰‡å’Œæ–‡å­—åŠ å…¥è¡Œ
            rowDiv.appendChild(img);
            rowDiv.appendChild(detailsDiv);

            // åŠ å…¥åˆ°å®¹å™¨
            container.appendChild(rowDiv);
          });
        });
      };
      reader.readAsArrayBuffer(file);
    }
  </script>
    <!-- å¼•ç”¨å¤–éƒ¨ JavaScript æ–‡ä»¶ -->
    <script src="category.js"></script>

    <!-- è¼‰å…¥ JsBarcode åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.0/JsBarcode.all.min.js"></script>
    <script>
        function updateQRCode() {
    var qrValue = document.getElementById("barcodeInput").value;
    var canvas = document.getElementById("qrCanvas");

    if (qrValue.trim() !== "") {
        QRCode.toCanvas(canvas, qrValue, {
            width: 200,
            margin: 2
        }, function (error) {
            if (error) {
                console.error(error);
            }
        });
    } else {
        // æ¸…ç©º QR Code
        var ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
}

// åˆå§‹åŒ– QR Code
updateQRCode();

function calculatePTA() {
    // ç²å–å³è€³å’Œå·¦è€³çš„æ•¸å€¼ï¼Œä¸¦å°‡å…¶è½‰æ›ç‚ºæµ®é»æ•¸
    var rightEarData = [
        parseFloat(document.getElementById("rightEar_500Hz").value) || 0,
        parseFloat(document.getElementById("rightEar_1000Hz").value) || 0,
        parseFloat(document.getElementById("rightEar_2000Hz").value) || 0,
        parseFloat(document.getElementById("rightEar_4000Hz").value) || 0
    ];

    var leftEarData = [
        parseFloat(document.getElementById("leftEar_500Hz").value) || 0,
        parseFloat(document.getElementById("leftEar_1000Hz").value) || 0,
        parseFloat(document.getElementById("leftEar_2000Hz").value) || 0,
        parseFloat(document.getElementById("leftEar_4000Hz").value) || 0
    ];

    // è¨ˆç®—å³è€³å’Œå·¦è€³çš„ç´”éŸ³å¹³å‡ï¼ˆPTAï¼‰
    var rightEarPTA = calculateAverage(rightEarData);
    var leftEarPTA = calculateAverage(leftEarData);

    // è¨ˆç®—å–®è€³è½éšœæ¯”ç‡ï¼ˆè‹¥å°æ–¼ 25dBï¼Œå‰‡ç‚º 0%ï¼‰
    var rightEarHearingLoss = (rightEarPTA < 25) ? 0 : ((rightEarPTA - 25) * 150) / 100;
    var leftEarHearingLoss = (leftEarPTA < 25) ? 0 : ((leftEarPTA - 25) * 150) / 100;

    // åˆ¤æ–·å“ªä¸€éš»è€³æœµè½åŠ›è¼ƒä½³
    var betterEar = "";
    if (rightEarHearingLoss < leftEarHearingLoss) {
        betterEar = "å³è€³";
    } else if (leftEarHearingLoss < rightEarHearingLoss) {
        betterEar = "å·¦è€³";
    }

    // è¨ˆç®—é›™è€³è½éšœæ¯”ç‡ï¼ˆå„ªè€³æ¬Šé‡è¼ƒé«˜ï¼‰
    var bilateralHearingLoss = 0;
    if (rightEarHearingLoss > leftEarHearingLoss && leftEarHearingLoss > 0) {
        bilateralHearingLoss = ((rightEarHearingLoss * 1) + (leftEarHearingLoss * 5)) / 6;
    } else if (leftEarHearingLoss > rightEarHearingLoss && rightEarHearingLoss > 0) {
        bilateralHearingLoss = ((rightEarHearingLoss * 5) + (leftEarHearingLoss * 1)) / 6;
    }

    // æ›´æ–° HTML é é¢ä¸Šçš„çµæœé¡¯ç¤º
    document.getElementById("rightEar_PTA").innerHTML = rightEarPTA.toFixed(1);
    document.getElementById("leftEar_PTA").innerHTML = leftEarPTA.toFixed(1);
    document.getElementById("rightEar_HL").innerHTML = rightEarHearingLoss.toFixed(1) + "%";
    document.getElementById("leftEar_HL").innerHTML = leftEarHearingLoss.toFixed(1) + "%";
    document.getElementById("bilateral_HL").innerHTML = bilateralHearingLoss.toFixed(1) + "%";

    // æ ¹æ“šè¼ƒä½³è€³æœµå¥—ç”¨ä¸åŒçš„ CSS æ¨£å¼
    var betterEarElement = document.getElementById("betterEar");
    if (betterEar === "å·¦è€³") {
        betterEarElement.className = "blue-text";
    } else if (betterEar === "å³è€³") {
        betterEarElement.className = "red-text";
    } else {
        betterEarElement.className = ""; // è‹¥ç„¡å„ªè€³å‰‡æ¸…é™¤æ¨£å¼
    }

    // è¨­å®šå„ªè€³é¡¯ç¤ºå…§å®¹
    betterEarElement.innerHTML = betterEar;
}

// è¨ˆç®—é™£åˆ—çš„å¹³å‡å€¼ï¼Œç¢ºä¿å›ºå®šé™¤ä»¥ 4
function calculateAverage(data) {
    var sum = data.reduce((acc, val) => acc + val, 0);
    return sum / 4; // å›ºå®šé™¤ä»¥ 4ï¼Œç¢ºä¿æ­£ç¢ºè¨ˆç®— PTA
}

// æ¸…ç©ºæ‰€æœ‰è¼¸å…¥æ¡†çš„å€¼
function clearInput() {
    var inputElements = document.getElementsByTagName("input");
    for (var i = 0; i < inputElements.length; i++) {
        inputElements[i].value = "";
    }
}

    </script>

  <script>
    // ç²å–æŒ‰éˆ•å…ƒç´ 
    const backToTopButton = document.getElementById('backToTop');

    // æ»¾å‹•äº‹ä»¶ï¼šæ§åˆ¶æŒ‰éˆ•é¡¯ç¤º/éš±è—
    window.addEventListener('scroll', () => {
        if (window.scrollY > 200) {
            backToTopButton.style.display = 'block';
        } else {
            backToTopButton.style.display = 'none';
        }
    });

    // æŒ‰éˆ•é»æ“Šäº‹ä»¶ï¼šå›åˆ°é é¢é ‚éƒ¨
    backToTopButton.addEventListener('click', () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth' // å¹³æ»‘æ»¾å‹•æ•ˆæœ
        });
    });
</script>
<script>
  if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/barcode/service-worker.js')
        .then((registration) => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
        })
        .catch((err) => {
            console.log('ServiceWorker registration failed: ', err);
        });
    }
</script>
</body>
</html>
